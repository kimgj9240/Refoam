<nav th:fragment="navbar(activeMenu)"
     class="navbar navbar-expand-md nav-bg fixed-top py-0">
    <!-- 메뉴바 시작-->
    <div class="container-fluid">
        <a class="navbar-brand nav-font" th:href="@{/main}">
            <img src="/images/logo_only.svg" alt="logo" class="my-2 ms-3 nav-img">
            <img src="/images/logo_name.svg" alt="logo" class="my-2 md-hidden nav-img">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown"
                aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
            <ul class="navbar-nav ms-auto mb-2 mb-md-0">
                <li class="nav-item my-1 d-flex align-items-center gap-2 nav-account" th:if="${loginMember != null}">
                    <img src="/images/person-circle.svg" alt="사람 아이콘">
                    <span class="nav-font nav-no-link" th:text="${loginMember.username}+'님'">관리자</span>

                    <!-- 종 아이콘 + 알림 개수 표시 + 드롭다운 -->
                    <div class="nav-item dropdown position-relative">
                        <a class="nav-link dropdown-toggle p-0" href="#" id="alertDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <img src="/images/bell-fill.svg" alt="종모양">
                            <span th:text="${(alertCount == null or alertCount == 0) ? 0 : (alertCount > 99 ? '99+' : alertCount)}"
                                  class="position-absolute top-0 start-100 translate-middle badge rounded-pill badge-size">0</span>
                        </a>
                        <ul class="dropdown-menu alert-dropdown dropdown-center" aria-labelledby="alertDropdown">
                            <li><h6 class="dropdown-header border-bottom pb-3">알림</h6></li>
                            <li th:each="alert : ${alertList}">
                                <a class="dropdown-item border-bottom alert-item py-2"
                                   th:href="@{'/alert/read/' + ${alert.id} + '?orderId=' + ${alert.order.id}}">
                                    <div><strong th:text="'[주문 ' + ${alert.order.id} + ']'"></strong></div>
                                    <div th:text="${alert.order.productName} + ' 제품 공정 중 '+ ${alert.message}"></div>
                                </a>
                            </li>
                            <li th:if="${#lists.isEmpty(alertList)}">
                                <span class="dropdown-item text-muted">알림이 없습니다.</span>
                            </li>
                        </ul>
                    </div>
                    <form th:action="@{/logout}" method="post">
                        <button type="submit" class="nav-font btn btn-sm btn-refoam margin-minus ms-3">로그아웃</button>
                    </form>
                    <div class="vr md-hidden"></div>
                </li>


                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle nav-font" href="#" role="button" data-bs-toggle="dropdown"
                       aria-expanded="false" th:classappend="${activeMenu == 1} ? ' active' : ''">
                        계정관리
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li th:if="${loginMember.position.name() != 'STAFF'}"><a class="dropdown-item nav-font"
                                                                                 th:href="@{/employee/list}">직원리스트</a>
                        </li>
                        <li th:if="${loginMember.position.name() != 'STAFF'}"><a class="dropdown-item nav-font"
                                                                                 th:href="@{/employee/new}">직원 정보 등록</a>
                        </li>
                        <li th:if="${loginMember.position.name() != 'ADMIN'}"><a class="dropdown-item nav-font"
                                                                                 th:href="@{/employee/{id}/edit(id=${loginMember.id})}">계정
                            정보 수정</a></li>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle nav-font" href="#" role="button" data-bs-toggle="dropdown"
                       aria-expanded="false" th:classappend="${activeMenu == 2} ? ' active' : ''">
                        재고관리
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item nav-font" th:href="@{/material/list}">재고 리스트</a></li>
                        <li><a class="dropdown-item nav-font" th:href="@{/material/new}">재고입력발주</a></li>

                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle nav-font" href="#" role="button" data-bs-toggle="dropdown"
                       aria-expanded="false" th:classappend="${activeMenu == 3} ? ' active' : ''">
                        공정관리
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item nav-font" th:href="@{/order/new}">제품생산</a></li>
                        <li><a class="dropdown-item nav-font" th:href="@{/order/list}">주문리스트</a></li>
                    </ul>
                </li>
                <li class="nav-item">
                    <a class="nav-link nav-font" th:href="@{/monitoring/main}"
                       th:classappend="${activeMenu == 4} ? ' active' : ''">에러모니터링</a>
                </li>
            </ul>
        </div>
    </div>
    <!-- 메뉴바 끝 -->
    <script>
        async function checkErrorAlert() {
            try {
                const res = await fetch('/api/alerts/check');
                const data = await res.json();
                const bellIcon = document.getElementById('error-alert-bell');

                if (data.alert) {
                    bellIcon.classList.add('active'); // 색상 변경 or 효과 추가
                } else {
                    bellIcon.classList.remove('active');
                }
            } catch (e) {
                console.error("알림 확인 실패:", e);
            }
        }

        // 30초마다 확인
        setInterval(checkErrorAlert, 30000);
        checkErrorAlert(); // 페이지 로드 시 최초 실행
    </script>
</nav>


